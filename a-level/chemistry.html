<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" type="text/css" href="../../styles.css">
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/series-label.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/data.js"></script>
  <script src="/theme.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <script type="text/javascript" src="a-level-text.json"></script> -->
</head>
<body>
  <select id="scopeSelector" autocomplete="off" onchange="scopeChange()">
    <option value="UK">UK</option>
    <option value="EN">England</option>
    <option value="WA">Wales</option>
    <option value="NI">Northern Ireland</option>
  </select>
  <div id="entriesChartContainer" class="chartContainer"></div>
  <select id="gradesSelector" autocomplete="off" onchange="gradeChartOptionChange()">
      <option value="Selected">Selected grades</option>
      <option value="All">All grades</option>
  </select>
  <select id="genderSelector" autocomplete="off" onchange="gradeChartOptionChange()">
      <option value="All students">All students</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
  </select>
  <div id="gradesChartContainer" class="chartContainer"></div>
  <div id="textContainer"></div>
  <!-- <script>
    $(function () {
        var people = [];
        $.getJSON('a-level-text.json', function(data) {
        // $.getJSON('test.json', function(data) {
            // console.log('a-level-text.json')
            console.log(data)
            $.each(data.person, function(i, f) {
                console.log(f)
                // var tblRow = "<tr>" + "<td>" + f.firstName + "</td>" +
                // "<td>" + f.lastName + "</td>" + "<td>" + f.job + "</td>" + "<td>" + f.roll + "</td>" + "</tr>"
                // $(tblRow).appendTo("#userdata tbody");
            });
        });
    });
  </script> -->
    <script>
      var subject = "Chemistry";
      var scope = "UK";
      var grades = "Selected"
      var gender = "All students"
      var entriesChartSubtitle
      var gradesChartSubtitle
      var coloursDict = {
          'All students':'#535353',
          'Male':'#2daae1',
          'Female':'#96c11f'
      }
      var gradesChartColoursArray = []
      gradesChartColoursArray.push(coloursDict['All students'])

      Highcharts.setOptions(Highcharts.theme)

      drawEntriesChart(scope, grades, gender)
      drawGradesChart(scope, grades, gender)

      var entriesData=[]
      var gradesData=[]

      levels=[
      	{
      		'name':'A-Level',
      		'grades_all':['A*','A','B','C','D','E','U'],
          'grades_selected':['A*','A','C','E']
      	},
      	{
      		'name':'AS-Level',
      		'grades_all':['A','B','C','D','E','U'],
          'grades_selected':['A','C','E']
      	},
      	{
      	 	'name':'GCSE',
      		'grades_all':['A/7','C/4','G/1','U'],
          'grades_selected':['A/7','C/4','G/1','U']
      	}
      ]

      function grabEntriesData() {
              $.getJSON('a-level-entries.json', function(data) {
                entriesData=[]
                let len=data.length
                if(len>0){
                    for(let i=0; i<len; i++){
                        var line=data.shift()
                        if (line.Subject == subject && line.Coverage == scope){
                          entriesData.push(line)
                        }
                    }
  		          }
              });
          };

      function grabGradesData() {
        $.getJSON('a-level-grades.json', function(data) {
          gradesData=[]
          let grades_array=[]
          if(grades == "Selected"){    // XXX: needs updating to handle AS-Level, GCSE grades
            grades_array=levels[0]['grades_selected']
          }
          else if (grades == "All") {
            grades_array=levels[0]['grades_all']
          }
          let len=data.length
          if(len>0){
              for(let i=0; i<len; i++){
                  var line=data.shift()
                  if (line.Subject == subject && line.Coverage == scope && grades_array.indexOf(line.name)!=-1 && line.Gender== gender){
                    gradesData.push(line)
                  }
              }
          }
        });
      };

      function scopeChange() {
            scope = document.getElementById("scopeSelector").value
            drawEntriesChart(scope, grades, gender)
            drawGradesChart(scope, grades, gender)
          }

      function gradeChartOptionChange() {
        grades = document.getElementById("gradesSelector").value
        gender = document.getElementById("genderSelector").value
        drawGradesChart(scope, grades, gender)
      }

      function setChartSubtitles(scope, grades, gender) {
          let scopeDict = {
              'UK':'UK-wide',
              'EN':'England',
              'WA':'Wales',
              'NI':'Northern Ireland'
          }
          let gradesDict = {
              'Selected':'selected grades',
              'All':'all grades'
          }
          let genderDict = {
              'All students':'All students',
              'Male':'Male students',
              'Female':'Female students',
          }
          entriesChartSubtitle = 'All students, ' + scopeDict[scope]
          gradesChartSubtitle = genderDict[gender] + ', ' + scopeDict[scope] + ', ' + gradesDict[grades]
          return entriesChartSubtitle, gradesChartSubtitle
      }

      function drawEntriesChart(scope, grades, gender) {
        grabEntriesData()
        setChartSubtitles(scope, grades, gender)
        gradesChartColoursArray = []
        gradesChartColoursArray.push(coloursDict[gender])
        var js = document.createElement('script');
        js.setAttribute('type', 'text/javascript');
        js.src = "../../a_level_entries.js";
        document.body.appendChild(js)
      }

      function drawGradesChart(scope, grades, gender) {
        grabGradesData()
		    setChartSubtitles(scope, grades, gender)
        gradesChartColoursArray = []
        gradesChartColoursArray.push(coloursDict[gender])
        var js = document.createElement('script');
        js.setAttribute('type', 'text/javascript');
        js.src = "../../a_level_grades.js";
        document.body.appendChild(js)
      }

    </script>
</body>
<html>
