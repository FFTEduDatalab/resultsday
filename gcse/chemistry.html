<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" type="text/css" href="../../styles.css">
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/series-label.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/data.js"></script>
  <script src="/theme.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
  <select id="breakdownSelector" autocomplete="off">
      <option value="coverage">Coverage</option>
      <option value="age">Age</option>
  </select>
  <select id="scopeSelector" autocomplete="off" onchange="scopeChange()">
    <option value="UK">UK</option>
    <option value="EN">England</option>
    <option value="WA">Wales</option>
    <option value="NI">Northern Ireland</option>
  </select>
  <div id="entriesChartContainer" class="chartContainer"></div>
  <select id="gradesSelector" autocomplete="off" onchange="gradeChartOptionChange()">
      <option value="Selected">Selected grades</option>
      <option value="All">All grades</option>
  </select>
  <select id="genderSelector" autocomplete="off" onchange="gradeChartOptionChange()">
      <option value="All students">All students</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
  </select>
  <div id="gradesChartContainer" class="chartContainer"></div>
  <div id="textContainer"></div>
    <script>
      var level='GCSE'
      var subject = "Chemistry";
      var breakdown = "Coverage";
      var scope = "UK";
      var grades = "Selected"
      var gender = "All students"
      var entriesChartSubtitle
      var gradesChartSubtitle
      var coloursDict = {
          'All students':'#535353',
          'Male':'#2daae1',
          'Female':'#96c11f'
      }
      var gradesChartColoursArray = []
      gradesChartColoursArray.push(coloursDict['All students'])

      Highcharts.setOptions(Highcharts.theme)

      drawEntriesChart(scope, grades, gender)
      drawGradesChart(scope, grades, gender)

      var entriesData=[]
      var gradesData=[]

      levels=[
      	{
      		'name':'A-Level',
      		'grades_all':['A*','A','B','C','D','E','U'],
          'grades_selected':['A*','A','C','E']
      	},
      	{
      		'name':'AS-Level',
      		'grades_all':['A','B','C','D','E','U'],
          'grades_selected':['A','C','E']
      	},
      	{
      	 	'name':'GCSE',
      		'grades_all':['A/7','C/4','G/1','U'],
          'grades_selected':['A/7','C/4','G/1']
      	}
      ]

        $(function () {
            $.getJSON('gcse-text.json', function(data) {
                let len=data.length
                if(len>0){
                    for(let i=0; i<len; i++){
                        var line=data.shift()
                        if (line.subject == subject){
                          document.getElementById("textContainer").innerHTML=line.text
                        }
                    }
                }
            });
        });

        function readEntriesData() {
            $.getJSON('gcse-entries.json', function(data) {
              entriesData=[]
              let len=data.length
              console.log(data)
              if(len>0){
                  for(let i=0; i<len; i++){
                      var line=data.shift()
                      if (line.Subject == subject && line.Scope == scope){
                        entriesData.push(line)
                      }
                  }
		          }
              console.log(entriesData)
            });
        };

      function readLevelGrades(level) {
        return levels.filter(function(levels) {
          return levels.name == level
        });
      }

      function readGradesData() {
        $.getJSON('gcse-grades.json', function(data) {
          gradesData=[]
          let grades_array=[]
          if(grades == "Selected"){
            grades_array=readLevelGrades(level)[0]['grades_selected']
          }
          else if (grades == "All") {
            grades_array=readLevelGrades(level)[0]['grades_all']
          }
          let len=data.length
          if(len>0){
              for(let i=0; i<len; i++){
                  var line=data.shift()
                  if (line.Subject == subject && line.Scope == scope && grades_array.indexOf(line.name)!=-1 && line.Gender== gender){
                    gradesData.push(line)
                  }
              }
          }
        });
      };

      function scopeChange() {
            scope = document.getElementById("scopeSelector").value
            drawEntriesChart(scope, grades, gender)
            drawGradesChart(scope, grades, gender)
          }

      function gradeChartOptionChange() {
        grades = document.getElementById("gradesSelector").value
        gender = document.getElementById("genderSelector").value
        drawGradesChart(scope, grades, gender)
      }

      function setChartSubtitles(scope, grades, gender) {
          let scopeDict = {
              'UK':'UK-wide',
              'EN':'England',
              'WA':'Wales',
              'NI':'Northern Ireland',
              '15':'15-year-olds and younger',
              '16':'16-year-olds',
              '17':'17-year-olds and older'
          }
          let gradesDict = {
              'Selected':'selected grades',
              'All':'all grades'
          }
          let genderDict = {
              'All students':'All students',
              'Male':'Male students',
              'Female':'Female students',
          }
          entriesChartSubtitle = 'All students, ' + scopeDict[scope]
          gradesChartSubtitle = genderDict[gender] + ', ' + scopeDict[scope] + ', ' + gradesDict[grades]
          return entriesChartSubtitle, gradesChartSubtitle
      }

      function drawEntriesChart(scope, grades, gender) {
        readEntriesData()
        setChartSubtitles(scope, grades, gender)
        gradesChartColoursArray = []
        gradesChartColoursArray.push(coloursDict[gender])
        var js = document.createElement('script');
        js.setAttribute('type', 'text/javascript');
        js.src = "../../gcse_entries.js";
        document.body.appendChild(js)
      }

      function drawGradesChart(scope, grades, gender) {
        readGradesData()
		    setChartSubtitles(scope, grades, gender)
        gradesChartColoursArray = []
        gradesChartColoursArray.push(coloursDict[gender])
        var js = document.createElement('script');
        js.setAttribute('type', 'text/javascript');
        js.src = "../../gcse_grades.js";
        document.body.appendChild(js)
      }

      $(document).ready(function () {
        $("#breakdownSelector").change(function () {
          breakdown = $(this).val();
          if (breakdown == "coverage") {
            $("#scopeSelector").html("<option value='UK'>UK</option><option value='EN'>England</option><option value='WA'>Wales</option><option value='NI'>Northern Ireland</option>");
          }
          else if (breakdown == "age") {
            $("#scopeSelector").html("<option value='UK'>All ages</option><option value='15'>15-year-olds and younger</option><option value='16'>16-year-olds</option><option value='17'>17-year-olds and older</option>");
          }
          if(scope!="UK"){
              scope = "UK"
              drawEntriesChart(scope, grades, gender)
              drawGradesChart(scope, grades, gender)
          }
        });
      });

    </script>
</body>
<html>
